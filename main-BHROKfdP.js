import{r as a,j as e,C as U,u as z,T as d,B as C,S as G,P as O,c as X}from"./three-D8slNa4G.js";import"./vendor-9sitkZcQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const Y=`
struct VertexInput {
  @location(0) position: vec3<f32>,
  @location(1) normal: vec3<f32>,
  @location(2) uv: vec2<f32>,
}

struct VertexOutput {
  @builtin(position) clip_position: vec4<f32>,
  @location(0) world_position: vec3<f32>,
  @location(1) normal: vec3<f32>,
  @location(2) uv: vec2<f32>,
}

struct Uniforms {
  view_proj: mat4x4<f32>,
  model: mat4x4<f32>,
  time: f32,
  light_position: vec3<f32>,
}

@group(0) @binding(0)
var<uniform> uniforms: Uniforms;

@vertex
fn vs_main(input: VertexInput) -> VertexOutput {
  var out: VertexOutput;
  
  let world_position = uniforms.model * vec4<f32>(input.position, 1.0);
  out.world_position = world_position.xyz;
  out.clip_position = uniforms.view_proj * world_position;
  out.normal = normalize((uniforms.model * vec4<f32>(input.normal, 0.0)).xyz);
  out.uv = input.uv;
  
  return out;
}
`,V=`
struct FragmentInput {
  @location(0) world_position: vec3<f32>,
  @location(1) normal: vec3<f32>,
  @location(2) uv: vec2<f32>,
}

struct Uniforms {
  view_proj: mat4x4<f32>,
  model: mat4x4<f32>,
  time: f32,
  light_position: vec3<f32>,
}

@group(0) @binding(0)
var<uniform> uniforms: Uniforms;

@group(0) @binding(1)
var texture_sampler: sampler;

@group(0) @binding(2)
var metallic_texture: texture_2d<f32>;

@fragment
fn fs_main(input: FragmentInput) -> @location(0) vec4<f32> {
  let uv = input.uv;
  let world_pos = input.world_position;
  let normal = normalize(input.normal);

  // Sample metallic texture for base color
  var base_color = textureSample(metallic_texture, texture_sampler, uv).rgb;

  // Lighting calculation
  let light_dir = normalize(uniforms.light_position - world_pos);
  let view_dir = normalize(-world_pos); // Assuming camera at origin
  let half_dir = normalize(light_dir + view_dir);

  // Diffuse lighting
  let diffuse = max(0.0, dot(normal, light_dir));

  // Specular lighting (stronger for metallic)
  let specular = pow(max(0.0, dot(normal, half_dir)), 64.0) * 0.5;

  // Ambient lighting
  let ambient = 0.4;

  // Final color composition
  let final_color = base_color * (ambient + diffuse * 0.7) + vec3<f32>(specular);

  return vec4<f32>(final_color, 1.0);
}
`;class q{device;pipeline=null;uniformBuffer=null;metallicTexture=null;bindGroup=null;constructor(t){this.device=t}async initialize(){const t=this.device.createShaderModule({code:Y}),r=this.device.createShaderModule({code:V});this.uniformBuffer=this.device.createBuffer({size:160,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const s=await fetch("./src/assets/textures/metallic.png"),i=await createImageBitmap(await s.blob());this.metallicTexture=this.device.createTexture({size:[i.width,i.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.device.queue.copyExternalImageToTexture({source:i},{texture:this.metallicTexture},[i.width,i.height]);const o=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"unfilterable-float"}}]}),l=this.device.createSampler({magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",addressModeU:"repeat",addressModeV:"repeat"});this.bindGroup=this.device.createBindGroup({layout:o,entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:l},{binding:2,resource:this.metallicTexture.createView()}]}),this.pipeline=this.device.createRenderPipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[o]}),vertex:{module:t,entryPoint:"vs_main",buffers:[{arrayStride:32,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1},{format:"float32x2",offset:24,shaderLocation:2}]}]},fragment:{module:r,entryPoint:"fs_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list",cullMode:"back"}})}updateUniforms(t,r,s,i){if(!this.uniformBuffer)return;const o=new Float32Array(40);o.set(t,0),o.set(r,16),o[32]=s,o.set(i,33),this.device.queue.writeBuffer(this.uniformBuffer,0,o.buffer)}render(t,r,s,i){!this.pipeline||!this.bindGroup||(t.setPipeline(this.pipeline),t.setBindGroup(0,this.bindGroup),t.setVertexBuffer(0,r),t.setIndexBuffer(s,"uint16"),t.drawIndexed(i))}}class H{device=null;context=null;canvas;fallbackToWebGL=!1;webglContext=null;sandstoneMaterial=null;quadVertexBuffer=null;quadIndexBuffer=null;depthTexture=null;constructor(t){this.canvas=t}async initialize(){try{if("gpu"in navigator&&navigator.gpu){const t=navigator.gpu,r=await t.requestAdapter();if(r&&(this.device=await r.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.context&&this.device))return this.context.configure({device:this.device,format:t.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),this.sandstoneMaterial=new q(this.device),await this.sandstoneMaterial.initialize(),this.createFullScreenQuad(),!0}}catch{}return this.initializeWebGL()}initializeWebGL(){try{if(this.webglContext=this.canvas.getContext("webgl2")||this.canvas.getContext("webgl"),this.webglContext)return this.fallbackToWebGL=!0,this.webglContext.enable(this.webglContext.DEPTH_TEST),this.webglContext.enable(this.webglContext.CULL_FACE),!0}catch{}return!1}render(t,r,s){this.fallbackToWebGL?this.renderWebGL(t,r,s):this.renderWebGPU(t,r,s)}renderWebGPU(t,r,s){if(!this.device||!this.context)return;const i=this.device.createCommandEncoder(),l={colorAttachments:[{view:this.context.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:0},loadOp:"clear",storeOp:"store"}]},c=i.beginRenderPass(l);if(this.sandstoneMaterial&&this.quadVertexBuffer&&this.quadIndexBuffer){const f=performance.now()/1e3,y=new Float32Array([2,5,10]),h=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),w=new Float32Array(16);w.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.sandstoneMaterial.updateUniforms(w,h,f,y),this.sandstoneMaterial.render(c,this.quadVertexBuffer,this.quadIndexBuffer,6)}for(const f of t)this.renderObjectWebGPU(c,f,r,s);c.end(),this.device.queue.submit([i.finish()])}renderObjectWebGPU(t,r,s,i){r.mesh}createFullScreenQuad(){if(!this.device)return;const t=new Float32Array([-1,-1,.999,0,0,1,0,1,1,-1,.999,0,0,1,1,1,1,1,.999,0,0,1,1,0,-1,1,.999,0,0,1,0,0]),r=new Uint16Array([0,1,2,0,2,3]);this.quadVertexBuffer=this.device.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.quadVertexBuffer.getMappedRange()).set(t),this.quadVertexBuffer.unmap(),this.quadIndexBuffer=this.device.createBuffer({size:r.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint16Array(this.quadIndexBuffer.getMappedRange()).set(r),this.quadIndexBuffer.unmap()}renderWebGL(t,r,s){if(!this.webglContext)return;const i=this.webglContext;i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.viewport(0,0,this.canvas.width,this.canvas.height);for(const o of t)this.renderObjectWebGL(o,r,s)}renderObjectWebGL(t,r,s){this.webglContext}resize(t,r){this.canvas.width=t,this.canvas.height=r,this.isWebGPU()&&this.device&&this.context&&(this.context.configure({device:this.device,format:navigator.gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture({size:[t,r],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})),this.fallbackToWebGL&&this.webglContext&&this.webglContext.viewport(0,0,t,r)}dispose(){this.device&&this.device.destroy(),this.device=null,this.context=null,this.webglContext=null}isWebGPU(){return!this.fallbackToWebGL&&this.device!==null}isWebGL(){return this.fallbackToWebGL&&this.webglContext!==null}}function $(n,t,r,s){const i=1/Math.tan(n/2),o=1/(r-s);return new Float32Array([i/t,0,0,0,0,i,0,0,0,0,(s+r)*o,-1,0,0,2*s*r*o,0])}function Q(n,t,r){const s=B(J(n,t)),i=B(W(r,s)),o=W(s,i);return new Float32Array([i[0],o[0],s[0],0,i[1],o[1],s[1],0,i[2],o[2],s[2],0,-R(i,n),-R(o,n),-R(s,n),1])}function J(n,t){return[n[0]-t[0],n[1]-t[1],n[2]-t[2]]}function W(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function R(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function B(n){const t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return t>0?[n[0]/t,n[1]/t,n[2]/t]:[0,0,0]}const Z=a.forwardRef(({src:n="/latest/kasm_canvas_jog_obs.html",title:t="Jog Canvas",width:r=150,height:s=150,style:i={},midiData:o},l)=>{const c=a.useRef(null);return a.useEffect(()=>{o&&c.current&&c.current.contentWindow&&c.current.contentWindow.postMessage({type:"MIDI_DATA",...o},"*")},[o]),a.useImperativeHandle(l,()=>({callKasmFunction:(f,y)=>{c.current&&c.current.contentWindow&&c.current.contentWindow.postMessage({type:"KASM",func:f,args:y},"*")}})),e.jsx("iframe",{ref:c,src:n,title:t,width:r,height:s,style:{border:"1px solid #ccc",borderRadius:"8px",...i}})}),ee=()=>{const n=a.useRef(null);return a.useEffect(()=>{function t(){const c=Math.floor(8)+1;return 40+5*Math.floor(Math.random()*c)}const r=100,s=setInterval(()=>{const i=t(),o=n.current;o&&o.callKasmFunction("update_canvas_data",{pitch:i,velocity:r,cc:!1}),o&&o.callKasmFunction("update_canvas_data",{pitch:i-10,velocity:0,cc:!1})},500);return()=>clearInterval(s)},[]),e.jsxs("p",{children:["New Component in v1.14!",e.jsx("br",{}),"Jog - video jogger canvas kasm_canvas_jog.rs",e.jsx("br",{}),e.jsx(Z,{ref:n})]})},te=()=>{const n=a.useRef(null);return a.useEffect(()=>{const t=r=>{n.current&&n.current.contentWindow&&n.current.contentWindow.postMessage({type:"KASM_KEY",key:r.key,code:r.code,altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,metaKey:r.metaKey},"*")};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[]),e.jsx("div",{style:{marginTop:"2rem",width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},onClick:()=>{n.current&&n.current.focus()},children:e.jsx("iframe",{ref:n,src:"/latest/emanator.html",title:"Kasm Demo",width:"90%",height:"1024",style:{border:"2px solid #ccc",borderRadius:"12px",boxShadow:"0 2px 16px rgba(0,0,0,0.12)"},allowFullScreen:!0,tabIndex:-1,onLoad:()=>{n.current&&n.current.focus()}})})};function ne({onNavigate:n}){function t(){const r=Math.floor(Math.random()*200),s=Math.floor(Math.random()*200);return`${r}px ${s}px`}return e.jsxs("div",{className:"kasm-landing-container",children:[e.jsx("h1",{children:"Kasm SDK"}),e.jsx("p",{style:{backgroundPosition:t()},children:"The main intention is interoperability between Web Browsers and DAWs using open standards, in particular to make head way for Augmented Reality glasses and Virtual Reality headset based instruments. The aim is to achieve this by utilising cross platform technologies such as WebAssembly, WebXR, WebGL/WebGPU, WebMIDI and OSC (Open Sound Control)"}),e.jsx("p",{style:{backgroundPosition:t()},children:"The collection has zero formal roadmap, there is no rule book here as to what's right or wrong way, there will certainly be better ways of doing things, but it's a start. The common goal here is ease of open patching and sharing of editor tools to support the many different use cases and musical genres"}),e.jsx("div",{style:{backgroundPosition:t()},children:e.jsxs("div",{className:"kasm-demo-buttons",children:[e.jsxs("button",{className:"kasm-demo-btn",onClick:()=>n("emanator"),children:["🎹 ",e.jsx("br",{}),"Emanator"]}),e.jsxs("button",{className:"kasm-demo-btn",onClick:()=>n("bangaz"),children:["🎹 ",e.jsx("br",{}),"Bangaz"]}),e.jsxs("button",{className:"kasm-demo-btn",onClick:()=>n("arpy"),children:["🎹 ",e.jsx("br",{}),"Arpy"]}),e.jsxs("button",{className:"kasm-demo-btn",onClick:()=>n("arpy"),children:["🎹 ",e.jsx("br",{}),"Triggaz"]})]})}),e.jsx(ee,{}),e.jsx(te,{})]})}function ie(){const n=a.useRef(null),[t,r]=a.useState({protocol:"TechWebMIDI",latency:"45ms",throughput:"125 Mbps",objects:1247,subscribers:8,publishers:3,quality:"Ultra Low Latency"});return z(()=>{r(s=>({...s,latency:`${(40+Math.sin(Date.now()*.001)*10).toFixed(0)}ms`,throughput:`${(120+Math.sin(Date.now()*.0015)*20).toFixed(0)} Mbps`,objects:s.objects+Math.floor(Math.random()*3),subscribers:8+Math.floor(Math.sin(Date.now()*.002)*2),publishers:3+Math.floor(Math.cos(Date.now()*.0025)*1)}))}),e.jsxs("group",{position:[0,0,-2],children:[e.jsx(d,{ref:n,position:[0,.8,0],fontSize:.25,color:"#00ff00",anchorX:"center",anchorY:"middle",children:"WebMIDI"}),e.jsxs(d,{position:[0,.4,0],fontSize:.12,color:"#ffff00",anchorX:"center",anchorY:"middle",children:["Protocol: ",t.protocol," | Quality: ",t.quality]}),e.jsxs(d,{position:[0,.2,0],fontSize:.1,color:"#ff6600",anchorX:"center",anchorY:"middle",children:["Latency: ",t.latency," | Throughput: ",t.throughput]}),e.jsxs(d,{position:[0,0,0],fontSize:.1,color:"#00ffff",anchorX:"center",anchorY:"middle",children:["Objects: ",t.objects," | Subscribers: ",t.subscribers]}),e.jsxs(d,{position:[0,-.2,0],fontSize:.1,color:"#ff00ff",anchorX:"center",anchorY:"middle",children:["Publishers: ",t.publishers]}),e.jsx(d,{position:[0,-.5,0],fontSize:.08,color:"#888888",anchorX:"center",anchorY:"middle",children:"Ultra-low latency media streaming over QUIC"})]})}function re(){const n=a.useRef(null),t=a.useRef(null),r=a.useRef([]),s=a.useRef(null);return z(()=>{const i=Date.now()*.001;if(n.current&&(n.current.rotation.y=i*.4,n.current.scale.setScalar(1+Math.sin(i*2)*.1)),t.current&&(t.current.rotation.x=i*.3,t.current.rotation.z=i*.2),r.current.forEach((o,l)=>{o&&(o.rotation.y=i*(.5+l*.1),o.position.y=Math.sin(i*(1+l*.3))*.1)}),s.current){s.current.position.x=Math.sin(i*3)*.4;const o=s.current.material;o&&"opacity"in o&&(o.opacity=.7+Math.sin(i*5)*.2)}}),e.jsxs("group",{position:[2,0,-2],children:[e.jsx(C,{ref:n,args:[.3,.3,.3],position:[-.8,.4,0],children:e.jsx("meshBasicMaterial",{color:"#00ff00"})}),e.jsx(G,{ref:t,args:[.2,16,16],position:[0,.2,0],children:e.jsx("meshBasicMaterial",{color:"#ffff00"})}),e.jsx(O,{ref:s,args:[.6,.03],position:[0,.4,0],children:e.jsx("meshBasicMaterial",{color:"#00ffff",transparent:!0})}),[0,1,2].map(i=>e.jsx(C,{ref:o=>{o&&(r.current[i]=o)},args:[.2,.2,.2],position:[.6+i*.3,-.2-i*.2,0],children:e.jsx("meshBasicMaterial",{color:"#ff6600"})},i)),e.jsx(d,{position:[-.8,.1,0],fontSize:.06,color:"#00ff00",anchorX:"center",anchorY:"middle",children:"Publisher"}),e.jsx(d,{position:[0,-.1,0],fontSize:.06,color:"#ffff00",anchorX:"center",anchorY:"middle",children:"WebMIDI Relay"}),e.jsx(d,{position:[.8,-.6,0],fontSize:.06,color:"#ff6600",anchorX:"center",anchorY:"middle",children:"Subscribers"}),e.jsx(d,{position:[0,-.9,0],fontSize:.08,color:"#ffffff",anchorX:"center",anchorY:"middle",children:"WebMIDI Network"}),e.jsx(d,{position:[0,-1.1,0],fontSize:.06,color:"#888888",anchorX:"center",anchorY:"middle",children:"QUIC Transport"})]})}function se(){const[n]=a.useState(["🚀 Ultra Low Latency","📦 Object-based Delivery","🔄 Adaptive Bitrate","🌐 CDN Integration","📱 Multi-device Sync","🔒 Built-in Security"]),[t]=a.useState(["Live Streaming","Interactive Media","Gaming Applications","Real-time Collaboration","IoT Data Streams"]);return e.jsxs("group",{position:[-2,0,-2],children:[e.jsx(d,{position:[0,1,0],fontSize:.12,color:"#ffffff",anchorX:"center",anchorY:"middle",children:"WebMIDI Features"}),n.map((r,s)=>e.jsx(d,{position:[0,.6-s*.15,0],fontSize:.07,color:"#00ff88",anchorX:"center",anchorY:"middle",children:r},s)),e.jsx(d,{position:[0,-.5,0],fontSize:.1,color:"#ffff00",anchorX:"center",anchorY:"middle",children:"Use Cases"}),t.map((r,s)=>e.jsxs(d,{position:[0,-.7-s*.1,0],fontSize:.06,color:"#ff6600",anchorX:"center",anchorY:"middle",children:["• ",r]},s))]})}function oe(){return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("pointLight",{position:[10,10,10]}),e.jsx(ie,{}),e.jsx(re,{}),e.jsx(se,{})]})}function ae(){const[n,t]=a.useState({webmidi:!1});return a.useEffect(()=>{(()=>{t({webmidi:!1})})()},[]),e.jsxs("div",{className:"webmidi-container",style:{width:"100%",height:"100vh",position:"relative"},children:[e.jsxs("div",{className:"webmidi-header",style:{position:"absolute",top:"20px",left:"20px",zIndex:10,background:"rgba(0, 0, 0, 0.7)",padding:"1rem",borderRadius:"10px",color:"white"},children:[e.jsx("h2",{children:"📡 WebMIDI"}),e.jsx("p",{children:"Ultra-low latency media streaming protocol"}),e.jsx("p",{style:{fontSize:"0.9em",marginTop:"10px",color:"#aaa"},children:"Object-based media delivery with Rust WebAssembly optimization"}),e.jsx("div",{style:{marginTop:"10px",fontSize:"0.8em"},children:e.jsxs("div",{style:{color:n.webmidi?"#00ff00":"#ffaa00"},children:[n.webmidi?"✅":"🚧"," WebMIDI (Experimental)"]})})]}),e.jsx(U,{camera:{position:[0,0,5],fov:75},style:{background:"linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%)"},children:e.jsx(oe,{})})]})}function ce(){const[n,t]=a.useState("webmidi");a.useEffect(()=>{const i=new URLSearchParams(window.location.search).get("module");i&&["webmidi"].includes(i)&&t(i)},[]);const r=[{id:"webmidi",name:"WebMIDI",icon:"📡",description:"TechWebMIDI"},{id:"webgpu",name:"WebGPU",icon:"📡",description:"WebGPU"}];return e.jsxs("div",{className:"tech-container",style:{width:"100%",height:"100vh",position:"relative"},children:[e.jsxs("div",{className:"tech-selector",style:{position:"absolute",top:"20px",right:"20px",zIndex:20,background:"rgba(0, 0, 0, 0.8)",borderRadius:"15px",padding:"1rem",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx("h3",{style:{color:"white",marginBottom:"1rem",fontSize:"1.1rem",textAlign:"center"},children:"🔧 Tech Demos"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.map(s=>e.jsx("button",{onClick:()=>t(s.id),style:{background:n===s.id?"rgba(0, 255, 136, 0.2)":"rgba(255, 255, 255, 0.1)",border:n===s.id?"1px solid rgba(0, 255, 136, 0.5)":"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"10px",padding:"0.75rem",color:"white",cursor:"pointer",transition:"all 0.3s ease",fontSize:"0.9rem",minWidth:"180px",textAlign:"left"},onMouseEnter:i=>{n!==s.id&&(i.currentTarget.style.background="rgba(255, 255, 255, 0.2)")},onMouseLeave:i=>{n!==s.id&&(i.currentTarget.style.background="rgba(255, 255, 255, 0.1)")},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.2rem",color:"var(--sandstone-base)"},children:s.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:s.name}),e.jsx("div",{style:{fontSize:"0.8rem",opacity:.8},children:s.description})]})]})},s.id))}),e.jsx("div",{style:{marginTop:"1rem",padding:"0.5rem",background:"rgba(255, 255, 255, 0.05)",borderRadius:"8px",fontSize:"0.8rem",color:"#aaa",textAlign:"center"},children:"Giving a home to various tech demos and experiments that might be useful to others."})]}),e.jsx("div",{className:"tech-module-display",style:{width:"100%",height:"100%"},children:n==="webmidi"&&e.jsx(ae,{})}),e.jsxs("div",{className:"tech-info",style:{position:"absolute",bottom:"20px",left:"20px",zIndex:10,background:"rgba(0, 0, 0, 0.7)",padding:"1rem",borderRadius:"10px",color:"white",maxWidth:"300px"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",color:"var(--sandstone-base)"},children:[r.find(s=>s.id===n)?.icon," ",r.find(s=>s.id===n)?.name]}),e.jsxs("p",{style:{fontSize:"0.9rem",lineHeight:"1.4",margin:0},children:[n==="webmidi"&&"How TechWebMIDI works, or at least is supposed to.",n==="webgpu"&&"How WebGPU can be used to speed instrument rendering and visualizations up."]})]})]})}function le(){const n=a.useRef(null),[t,r]=a.useState(0),s=[{title:"Kasm XR Experience",subtitle:"Advanced WebXR Platform",description:"Control virtual musical instruments that aren't quite all there"},{title:"Rust WebAssembly Core",subtitle:"High-Performance Computing",description:"Shared WASM foundation across all modules"},{title:"WebXR Innovation",subtitle:"Immersive Experiences",description:"AR/VR capabilities for modern web browsers"}];z(()=>{const o=Date.now(),l=Math.floor(o/3e3%s.length);l!==t&&r(l)});const i=s[t];return e.jsxs("group",{position:[0,0,-2],children:[e.jsx(d,{ref:n,position:[0,.8,0],fontSize:.25,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:i.title}),e.jsx(d,{position:[0,.4,0],fontSize:.15,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:i.subtitle}),e.jsx(d,{position:[0,0,0],fontSize:.12,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:i.description}),e.jsxs(d,{position:[0,-.4,0],fontSize:.08,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:[t+1," / ",s.length]})]})}function de(){const n=a.useRef(null),t=a.useRef(null),r=a.useRef(null);return z(()=>{const s=Date.now()*.001;n.current&&(n.current.rotation.y=s*.5,n.current.position.y=Math.sin(s)*.2),t.current&&(t.current.rotation.x=s*.3,t.current.position.y=Math.cos(s*1.2)*.15),r.current&&(r.current.rotation.z=s*.7,r.current.position.y=Math.sin(s*.8)*.25)}),e.jsxs("group",{position:[2,0,-2],children:[e.jsx(C,{ref:n,args:[.3,.3,.3],position:[0,.5,0],children:e.jsx("meshBasicMaterial",{color:"#ce422b"})}),e.jsx(G,{ref:t,args:[.15,16,16],position:[0,0,0],children:e.jsx("meshBasicMaterial",{color:"#00d4ff"})}),e.jsx(C,{ref:r,args:[.2,.2,.2],position:[0,-.5,0],children:e.jsx("meshBasicMaterial",{color:"#ff6b35"})}),e.jsx(d,{position:[0,-1,0],fontSize:.08,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:"Core Technologies"}),e.jsx(d,{position:[0,-1.2,0],fontSize:.06,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:"🦀 Rust WebAssembly"}),e.jsx(d,{position:[0,-1.35,0],fontSize:.06,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:"🥽 WebXR"}),e.jsx(d,{position:[0,-1.5,0],fontSize:.06,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:"⚡ WebGPU"})]})}function ue(){const[n]=a.useState(["🎵 TechWebMIDI Audio Synthesis","🥽 AR/VR MIDI Controllers"]);return e.jsxs("group",{position:[-2,0,-2],children:[e.jsx(d,{position:[0,1,0],fontSize:.12,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:"Platform Features"}),n.map((t,r)=>e.jsx(d,{position:[0,.6-r*.2,0],fontSize:.08,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:t},r)),e.jsx(d,{position:[0,-.8,0],fontSize:.06,color:"#fff600",outlineColor:"#fff600",outlineWidth:.01,anchorX:"center",anchorY:"middle",children:"Powered by Rust + WebAssembly"})]})}function he(){return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("pointLight",{position:[10,10,10]}),e.jsx(le,{}),e.jsx(de,{}),e.jsx(ue,{})]})}function fe(){return e.jsxs("div",{className:"about-container",style:{width:"100%",height:"100vh",position:"relative"},children:[e.jsxs("div",{className:"about-header",style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:10,maxWidth:"800px",width:"90%",color:"white",textAlign:"center"},children:[e.jsx("h2",{children:"About"}),e.jsx("p",{children:"Kasm SDK Open Source Community"}),e.jsx("p",{style:{fontSize:"0.9em",marginTop:"10px",color:"#aaa"},children:"Kasm SDK is an open source community project focused on building advanced web based musical instruments including AR and VR instruments and MIDI controllers"})]}),e.jsx(U,{camera:{position:[0,0,5],fov:75},style:{},children:e.jsx(he,{})})]})}const pe=({currentApp:n,onAppChange:t,appContext:r="main",onFilterChange:s})=>{const[i,o]=a.useState(!1),c=(()=>{switch(r){case"kasm":default:return[{id:"kasm",label:"Kasm SDK",icon:"🎹",description:"Documentation for the Kasm SDK"},{id:"emanator",label:"Emanator Editor",icon:"🎹",description:"Emanator editor tool"},{id:"bangaz",label:"Bangaz Drums",icon:"🎹",description:"Drum machine pattern editor tool"},{id:"arpy",label:"Arpy Editor",icon:"🎹",description:"Arpeggiator editor tool"},{id:"triggaz",label:"Triggers Editor",icon:"🎹",description:"Triggers MIDI note/cc pattern detection editor tool"}]}})(),f=h=>{if(r!=="main"&&s)s(h);else{t(h);const w=h;let j;switch(w){case"kasm":j=[{id:"kasm_emanator"},{id:"oscillators"},{id:"kasm_lfo"},{id:"effects"},{id:"kasm_canvas"},{id:"kasm_jog"},{id:"kasm_emanator_trans"}];break;case"tech":j=[{id:"webmidi"},{id:"webgpu"}];break;default:j=[]}j.length===0&&o(!1)}},y=()=>{t&&t("bangaz")};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:`hamburger-menu${i?" open":""}`,onClick:()=>o(!i),"aria-label":"Toggle navigation menu","aria-expanded":i,children:[e.jsx("span",{className:"hamburger-line"}),e.jsx("span",{className:"hamburger-line"}),e.jsx("span",{className:"hamburger-line"})]}),i&&e.jsx("div",{className:"sidebar-overlay",onClick:()=>o(!1)}),e.jsx("nav",{className:`sidebar${i?" open":""}`,children:e.jsxs("div",{className:"sidebar-content",children:[e.jsx("div",{className:"sidebar-header"}),r!=="main"&&e.jsx("div",{className:"sidebar-back-main",children:e.jsx("button",{className:"nav-link-back",style:{width:"100%",marginBottom:"1em",color:"#ffffff",fontWeight:"bold",borderRadius:0},onClick:y,children:"← Back to Main"})}),e.jsx("div",{className:"sidebar-nav",children:e.jsx("ul",{className:"nav-list",children:c.map(h=>e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link ${n===h.id?"active":""}`,onClick:()=>f(h.id),"aria-current":n===h.id?"page":void 0,children:[e.jsx("span",{className:"nav-icon",children:h.icon}),e.jsxs("div",{className:"nav-content",children:[e.jsx("span",{className:"nav-label",children:h.label}),e.jsx("span",{className:"nav-description",children:h.description})]})]})},h.id))})})]})})]})},D=({onDeviceChange:n,onChannelChange:t,initialDeviceId:r="",initialChannel:s=0})=>{const[i,o]=a.useState([]),[l,c]=a.useState(r),[f,y]=a.useState(s),h=()=>{navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(b=>{const p=[];b.outputs.forEach(S=>{p.push({id:S.id,name:S.name??"Unknown Device"})}),o(p)}).catch(()=>o([]))};a.useEffect(()=>{h()},[]);const w=b=>{c(b.target.value);const p=window;p.kasmWebMIDI&&p.kasmWebMIDI.setCurrentMidiOutput(b.target.value),n&&n(b.target.value)},j=b=>{const p=Number(b.target.value);y(p),t&&t(p)};return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("label",{children:e.jsxs("select",{style:{padding:"3px",marginLeft:"10px"},value:l,onChange:w,children:[e.jsx("option",{value:"",children:"Select MIDI Device..."}),i.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})}),e.jsx("button",{style:{marginLeft:"10px",padding:"3px 8px"},onClick:h,children:"<"}),e.jsxs("label",{style:{marginLeft:"20px"},children:["MIDI Channel:",e.jsx("select",{style:{padding:"3px",width:"40px",marginLeft:"10px"},value:f,onChange:j,children:[...Array(16)].map((b,p)=>e.jsx("option",{value:p,children:p+1},p))})]})]})},M=({src:n="/latest/kasm_canvas_obs.html",title:t="Emanator Canvas",width:r=150,height:s=150,style:i={}})=>e.jsx("iframe",{src:n,title:t,width:r,height:s,style:{border:"1px solid #ccc",borderRadius:"8px",...i}}),me=()=>e.jsxs("div",{className:"kasm-landing-container",children:[e.jsx("h1",{className:"main-title",children:"Bangaz Drum Pattern Browser and Editor"}),e.jsx("p",{children:"Bangaz are a collection step sequences meant to be played out General MIDI Drum kits and Ableton Drum Racks Drum patterns are effectively emanators, where the current step is expected to map musically and consistently over time"}),e.jsx("p",{children:"Bangaz drum pattern browser/gallery and web based pattern edit tools are coming here soon..."}),e.jsx("div",{style:{margin:"20px 0"},children:e.jsxs("p",{children:["Connect to your MIDI device... (you might need a ",e.jsx("a",{href:"https://help.ableton.com/hc/en-us/articles/209774225-Setting-up-a-virtual-MIDI-bus",target:"_blank",children:"virtual MIDI bus"}),")",e.jsx(D,{})]})}),e.jsxs("div",{style:{display:"flex",gap:"20px",justifyContent:"center",margin:"40px 0"},children:[e.jsx(M,{title:"Bangaz 1"}),e.jsx(M,{title:"Bangaz 2"}),e.jsx(M,{title:"Bangaz 3"})]}),e.jsx("div",{style:{marginTop:"2rem",width:"100%",display:"flex",justifyContent:"center"},children:e.jsx("iframe",{src:"https://kasmsdk.github.io/latest/bangaz.html",title:"Kasm Demo",width:"90%",height:"1024",style:{border:"2px solid #ccc",borderRadius:"12px",boxShadow:"0 2px 16px rgba(0,0,0,0.12)"},allowFullScreen:!0})})]}),P=[0,2,4,5,7,9,11],xe=["C","D","E","F","G","A","B"],L=[0,1,3,4,5],ge=[1,3,6,8,10],be=["C#","Eb","F#","G#","Bb"],_=60,N=2,k={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14,p:15,";":16,"'":17,"]":18,"\\":20},F=({onNoteOn:n,onNoteOff:t,highlightedNotes:r=[],velocity:s=100})=>{const[i,o]=a.useState([]),[l,c]=a.useState(0),[f,y]=a.useState(s),h=a.useRef(new Set);a.useEffect(()=>{y(s)},[s]),a.useEffect(()=>{const m=v=>{const g=v.key.toLowerCase();if(!v.repeat&&!h.current.has(g)){if(h.current.add(g),g==="z"){c(u=>Math.max(u-12,-48));return}if(g==="x"){c(u=>Math.min(u+12,48));return}if(g==="c"){y(u=>Math.max(u-10,1));return}if(g==="v"){y(u=>Math.min(u+10,127));return}if(Object.prototype.hasOwnProperty.call(k,g)){const u=_+k[g]+l;i.includes(u)||(o(E=>[...E,u]),n(u,f),window.kasm_rust&&typeof window.kasm_rust.update_canvas_data=="function"&&window.kasm_rust.update_canvas_data(u,f,!1))}}},x=v=>{const g=v.key.toLowerCase();if(h.current.delete(g),Object.prototype.hasOwnProperty.call(k,g)){const u=_+k[g]+l;o(E=>E.filter(K=>K!==u)),t(u),window.kasm_rust&&typeof window.kasm_rust.update_canvas_data=="function"&&window.kasm_rust.update_canvas_data(u,0,!1)}};return window.addEventListener("keydown",m),window.addEventListener("keyup",x),()=>{window.removeEventListener("keydown",m),window.removeEventListener("keyup",x)}},[l,f,i,n,t]);const w=m=>{i.includes(m)||(o(x=>[...x,m]),n(m,f),window.kasm_rust&&typeof window.kasm_rust.update_canvas_data=="function"&&window.kasm_rust.update_canvas_data(m,f,!1))},j=m=>{o(x=>x.filter(v=>v!==m)),t(m),window.kasm_rust&&typeof window.kasm_rust.update_canvas_data=="function"&&window.kasm_rust.update_canvas_data(m,0,!1)},b=[],p=40,S=24,T=100,I=160;for(let m=0;m<N;m++){for(let x=0;x<P.length;x++){const v=_+m*12+P[x],g=(m*7+x)*p;b.push(e.jsxs("g",{children:[e.jsx("rect",{x:g,y:0,width:p,height:I,fill:i.includes(v)||r.includes(v)?"lime":"white",stroke:"#333",strokeWidth:1,onMouseDown:()=>w(v),onMouseUp:()=>j(v),onMouseLeave:()=>j(v),onTouchStart:()=>w(v),onTouchEnd:()=>j(v),style:{cursor:"pointer"}}),e.jsx("text",{x:g+p/2,y:150,textAnchor:"middle",fontSize:14,fill:"#666",children:xe[x]})]},`w${m}-${x}`))}for(let x=0;x<L.length;x++){const v=L[x],g=(m*7+v)*p+p-S/2,u=_+m*12+ge[x];b.push(e.jsxs("g",{children:[e.jsx("rect",{x:g,y:0,width:S,height:T,fill:i.includes(u)||r.includes(u)?"#fbc02d":"#333",stroke:"#000",strokeWidth:1,onMouseDown:()=>w(u),onMouseUp:()=>j(u),onMouseLeave:()=>j(u),onTouchStart:()=>w(u),onTouchEnd:()=>j(u),style:{cursor:"pointer"}}),e.jsx("text",{x:g+S/2,y:90,textAnchor:"middle",fontSize:10,fill:"#fff",children:be[x]})]},`b${m}-${x}`))}}return e.jsx("svg",{width:N*7*p,height:I,style:{userSelect:"none",display:"block",background:"#f0f0f0",borderRadius:8,border:"2px solid #333"},children:b})},ve=()=>e.jsxs("div",{className:"kasm-landing-container",children:[e.jsx("h1",{children:"Emanator MIDI Pattern Browser and Editor Tool"}),e.jsx("p",{children:"Emanator is a collection of MIDI note patterns with CC articulations that continue playing, the concept of emanators is used in other contexts such as arpeggiators, and loops as they are all have similar results"}),e.jsxs("p",{children:["Pattern gallery/browser",e.jsx("br",{}),e.jsx(M,{title:"Emanator 1"}),e.jsx(M,{title:"Emanator 2"}),e.jsx(M,{title:"Emanator 3"})]}),e.jsx(D,{}),e.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0"},children:e.jsx(F,{onNoteOn:function(n,t){},onNoteOff:function(n){}})}),e.jsx("p",{children:"What is an emanator? Effectively it is a Rust function that is called upon to generate notes, each Emanator function has some common parameters like the root note and velocity to go on and a couple of generic encoders that change purpose depending on what the emanator is expected to do"}),e.jsxs("p",{children:["The file structure of Emanators is as follows, again there is no right or wrong way here...",e.jsxs("ul",{children:[e.jsx("li",{children:"arpeggiation.rs"}),e.jsx("li",{children:"experimental.rs"}),e.jsx("li",{children:"lfo.rs"}),e.jsx("li",{children:"mathematical.rs"}),e.jsx("li",{children:"mod.rs"}),e.jsx("li",{children:"responsorial.rs"}),e.jsx("li",{children:"spatial.rs"}),e.jsx("li",{children:"drumpattern.rs"}),e.jsx("li",{children:"harmonic.rs"}),e.jsx("li",{children:"loopcounterpoint.rs"}),e.jsx("li",{children:"melodic.rs"}),e.jsx("li",{children:"progressions.rs"}),e.jsx("li",{children:"rhythmic.rs"})]})]})]}),A=a.forwardRef(({src:n="/latest/kasm_canvas_jog_obs.html",title:t="Arpy Canvas",width:r=150,height:s=150,style:i={},midiData:o},l)=>{const c=a.useRef(null);return a.useEffect(()=>{o&&c.current&&c.current.contentWindow&&c.current.contentWindow.postMessage({type:"MIDI_DATA",...o},"*")},[o]),a.useImperativeHandle(l,()=>({callKasmFunction:(f,y)=>{c.current&&c.current.contentWindow&&c.current.contentWindow.postMessage({type:"KASM",func:f,args:y},"*")}})),e.jsx("iframe",{ref:c,src:n,title:t,width:r,height:s,style:{border:"1px solid #ccc",borderRadius:"8px",...i}})}),ye=()=>e.jsx("div",{style:{marginTop:"2rem",width:"100%",display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx("iframe",{src:"https://kasmsdk.github.io/latest/arpy.html",title:"Kasm Demo",width:"90%",height:"1024",style:{border:"2px solid #ccc",borderRadius:"12px",boxShadow:"0 2px 16px rgba(0,0,0,0.12)"},allowFullScreen:!0})}),je=()=>{const[n,t]=a.useState(null),r=a.useRef(null),s=(o,l)=>{window.inlet_5_emanator="Arpy",t({note:o,velocity:l,isCC:!1}),r.current&&r.current.callKasmFunction("update_canvas_data",{pitch:o,velocity:l,cc:!1})},i=o=>{t({note:o,velocity:0,isCC:!1}),r.current&&r.current.callKasmFunction("update_canvas_data",{pitch:o,velocity:0,cc:!1})};return e.jsxs("div",{className:"kasm-landing-container",children:[e.jsx("h1",{children:"Arpy arpeggio pattern Browser and Editor Tool"}),e.jsx("p",{children:"Arpy is a collection of arpeggios that are play whilst keys are held or are latched to keep playing out"}),e.jsxs("p",{children:["Pattern gallery/browser",e.jsx("br",{}),e.jsx(A,{ref:r,title:"Arpy Canvas 1",midiData:n}),e.jsx(A,{title:"Arpy Canvas 2",midiData:n}),e.jsx(A,{title:"Arpy Canvas 3",midiData:n})]}),e.jsx(D,{}),e.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0"},children:e.jsx(F,{onNoteOn:s,onNoteOff:i})}),e.jsx(ye,{})]})},we=()=>e.jsxs("div",{className:"kasm-landing-container",children:[e.jsx("h1",{children:"Triggaz midi note/cc pattern detection tool"}),e.jsx("p",{children:"Triggaz are a bit like Emanators in reverse, they look for patterns in the live performance and when a close enough match has been made it triggers an emanator, or a MIDI CC event or Ableton Live mapped parameter and so on"}),e.jsx("p",{children:"Triggaz detection pattern browser/gallery and web based pattern learning tools are coming here soon..."}),e.jsx("div",{style:{margin:"20px 0"},children:e.jsxs("p",{children:["Connect to your MIDI device... (you might need a ",e.jsx("a",{href:"https://help.ableton.com/hc/en-us/articles/209774225-Setting-up-a-virtual-MIDI-bus",target:"_blank",children:"virtual MIDI bus"}),")",e.jsx(D,{})]})}),e.jsxs("div",{style:{display:"flex",gap:"20px",justifyContent:"center",margin:"40px 0"},children:[e.jsx(M,{title:"Triggaz 1"}),e.jsx(M,{title:"Triggaz 2"}),e.jsx(M,{title:"Triggaz 3"})]})]});function Me(){const[n,t]=a.useState("kasm"),r=a.useRef(null);a.useEffect(()=>{const c=new URLSearchParams(window.location.search).get("app");c&&["kasm","tech","about","bangaz","arpy"].includes(c)?t(c):c&&["webmidi","webgpu"].includes(c)&&t("tech")},[]);const s=["kasm","emanator","bangaz","arpy","triggaz"].includes(n),i=()=>n==="kasm"?"kasm":n==="tech"?"tech":"main";a.useEffect(()=>{if(!r.current)return;const l=r.current,c=new H(l);let f;const y=async()=>{await c.initialize()&&(c.resize(window.innerWidth,window.innerHeight),h())},h=()=>{const S=Q([0,0,5],[0,0,0],[0,1,0]),T=window.innerWidth/window.innerHeight,I=$(45*(Math.PI/180),T,.1,100);c.render([],S,I),f=requestAnimationFrame(h)};y();const w=()=>{c.resize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w),cancelAnimationFrame(f),c.dispose()}},[]);const o=l=>{t(l)};return e.jsxs(e.Fragment,{children:[e.jsx("canvas",{ref:r,style:{position:"fixed",top:0,left:0,zIndex:-1,width:"100vw",height:"100vh"}}),e.jsxs("div",{className:"App",children:[e.jsx(pe,{currentApp:n,onAppChange:o,appContext:i()}),e.jsxs("div",{className:`app-content ${s?"standalone-mode":""}`,children:[n==="bangaz"&&e.jsx(me,{}),n==="arpy"&&e.jsx(je,{}),n==="triggaz"&&e.jsx(we,{}),n==="kasm"&&e.jsx(ne,{onNavigate:o}),n==="emanator"&&e.jsx(ve,{}),n==="tech"&&e.jsx(ce,{}),n==="about"&&e.jsx(fe,{})]})]})]})}X.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(Me,{})}));
